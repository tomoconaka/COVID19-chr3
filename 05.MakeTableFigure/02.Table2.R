setwd("/home/tomoko/results/")
final <- readRDS("../01.data.QC/curated_clinical/complication_dat_final.rds")
final <- final %>% mutate(height = ifelse(height == -1, NA, height))
final <- final %>% mutate(BMI = weight/((height/100)^2))
final$a1[final$a1 == -1] <- NA
final <- final %>% drop_na(`chr3:45823240:T:C_C`) %>% mutate(snp = ifelse(round(`chr3:45823240:T:C_C`) >= 1, 1, 0))

data_EUR <- final %>% filter(pop == "EUR") %>% drop_na(PC1) %>% drop_na(a1)
table(data_EUR[,c("a1")])
tbl <- table(data_EUR[,c("snp","a1")])
tmp1 <- binconf(tbl[1,2],sum(tbl[,2]))
tmp2 <- binconf(tbl[2,2],sum(tbl[,2]))
tmp3 <- binconf(tbl[1,1],sum(tbl[,1]))
tmp4 <- binconf(tbl[2,1],sum(tbl[,1]))
tbl[1,2] <- paste0(round(tmp1[1]*100,1),"% [",round(tmp1[2]*100,1),"; ",round(tmp1[3]*100,1),"] (",tbl[1,2],")")
tbl[2,2] <- paste0(round(tmp2[1]*100,1),"% [",round(tmp2[2]*100,1),"; ",round(tmp2[3]*100,1),"] (",tbl[2,2],")")
tbl[1,1] <- paste0(round(tmp3[1]*100,1),"% [",round(tmp3[2]*100,1),"; ",round(tmp3[3]*100,1),"] (",tbl[1,1],")")
tbl[2,1] <- paste0(round(tmp4[1]*100,1),"% [",round(tmp4[2]*100,1),"; ",round(tmp4[3]*100,1),"] (",tbl[2,1],")")
tbl

final <- final %>% filter(hospitalization == 1)

data_EUR <- final %>% filter(pop == "EUR") %>% drop_na(PC1) %>% drop_na(a1)
table(data_EUR[,c("a1")])
tbl <- table(data_EUR[,c("snp","a1")])
tmp1 <- binconf(tbl[1,2],sum(tbl[,2]))
tmp2 <- binconf(tbl[2,2],sum(tbl[,2]))
tmp3 <- binconf(tbl[1,1],sum(tbl[,1]))
tmp4 <- binconf(tbl[2,1],sum(tbl[,1]))
tbl[1,2] <- paste0(round(tmp1[1]*100,1),"% [",round(tmp1[2]*100,1),"; ",round(tmp1[3]*100,1),"] (",tbl[1,2],")")
tbl[2,2] <- paste0(round(tmp2[1]*100,1),"% [",round(tmp2[2]*100,1),"; ",round(tmp2[3]*100,1),"] (",tbl[2,2],")")
tbl[1,1] <- paste0(round(tmp3[1]*100,1),"% [",round(tmp3[2]*100,1),"; ",round(tmp3[3]*100,1),"] (",tbl[1,1],")")
tbl[2,1] <- paste0(round(tmp4[1]*100,1),"% [",round(tmp4[2]*100,1),"; ",round(tmp4[3]*100,1),"] (",tbl[2,1],")")
tbl

final <- readRDS("../01.data.QC/curated_clinical/complication_dat_final.rds")
final <- final %>% mutate(height = ifelse(height == -1, NA, height))
final <- final %>% mutate(BMI = weight/((height/100)^2))
final$a1[final$a1 == -1] <- NA
final <- final %>% drop_na(`chr3:45823240:T:C_C`) %>% mutate(snp = ifelse(round(`chr3:45823240:T:C_C`) >= 1, 1, 0))

data_EUR <- final %>% filter(age_at_diagnosis > 60) %>% filter(pop == "EUR") %>% drop_na(PC1)
table(data_EUR[,c("a1")])
tbl <- table(data_EUR[,c("snp","a1")])
tmp1 <- binconf(tbl[1,2],sum(tbl[,2]))
tmp2 <- binconf(tbl[2,2],sum(tbl[,2]))
tmp3 <- binconf(tbl[1,1],sum(tbl[,1]))
tmp4 <- binconf(tbl[2,1],sum(tbl[,1]))
tbl[1,2] <- paste0(round(tmp1[1]*100,1),"% [",round(tmp1[2]*100,1),"; ",round(tmp1[3]*100,1),"] (",tbl[1,2],")")
tbl[2,2] <- paste0(round(tmp2[1]*100,1),"% [",round(tmp2[2]*100,1),"; ",round(tmp2[3]*100,1),"] (",tbl[2,2],")")
tbl[1,1] <- paste0(round(tmp3[1]*100,1),"% [",round(tmp3[2]*100,1),"; ",round(tmp3[3]*100,1),"] (",tbl[1,1],")")
tbl[2,1] <- paste0(round(tmp4[1]*100,1),"% [",round(tmp4[2]*100,1),"; ",round(tmp4[3]*100,1),"] (",tbl[2,1],")")
tbl

data_EUR <- final %>% filter(age_at_diagnosis <= 60) %>% filter(pop == "EUR") %>% drop_na(PC1) %>% drop_na(a1)
table(data_EUR[,c("a1")])
tbl <- table(data_EUR[,c("snp","a1")])
tmp1 <- binconf(tbl[1,2],sum(tbl[,2]))
tmp2 <- binconf(tbl[2,2],sum(tbl[,2]))
tmp3 <- binconf(tbl[1,1],sum(tbl[,1]))
tmp4 <- binconf(tbl[2,1],sum(tbl[,1]))
tbl[1,2] <- paste0(round(tmp1[1]*100,1),"% [",round(tmp1[2]*100,1),"; ",round(tmp1[3]*100,1),"] (",tbl[1,2],")")
tbl[2,2] <- paste0(round(tmp2[1]*100,1),"% [",round(tmp2[2]*100,1),"; ",round(tmp2[3]*100,1),"] (",tbl[2,2],")")
tbl[1,1] <- paste0(round(tmp3[1]*100,1),"% [",round(tmp3[2]*100,1),"; ",round(tmp3[3]*100,1),"] (",tbl[1,1],")")
tbl[2,1] <- paste0(round(tmp4[1]*100,1),"% [",round(tmp4[2]*100,1),"; ",round(tmp4[3]*100,1),"] (",tbl[2,1],")")
tbl

final <- final %>% filter(hospitalization == 1)

data_EUR <- final %>% filter(age_at_diagnosis <= 60) %>% filter(pop == "EUR") %>% drop_na(PC1) %>% drop_na(a1)
table(data_EUR[,c("a1")])
tbl <- table(data_EUR[,c("snp","a1")])
tmp1 <- binconf(tbl[1,2],sum(tbl[,2]))
tmp2 <- binconf(tbl[2,2],sum(tbl[,2]))
tmp3 <- binconf(tbl[1,1],sum(tbl[,1]))
tmp4 <- binconf(tbl[2,1],sum(tbl[,1]))
tbl[1,2] <- paste0(round(tmp1[1]*100,1),"% [",round(tmp1[2]*100,1),"; ",round(tmp1[3]*100,1),"] (",tbl[1,2],")")
tbl[2,2] <- paste0(round(tmp2[1]*100,1),"% [",round(tmp2[2]*100,1),"; ",round(tmp2[3]*100,1),"] (",tbl[2,2],")")
tbl[1,1] <- paste0(round(tmp3[1]*100,1),"% [",round(tmp3[2]*100,1),"; ",round(tmp3[3]*100,1),"] (",tbl[1,1],")")
tbl[2,1] <- paste0(round(tmp4[1]*100,1),"% [",round(tmp4[2]*100,1),"; ",round(tmp4[3]*100,1),"] (",tbl[2,1],")")
tbl

data_EUR <- final %>% filter(age_at_diagnosis > 60) %>% filter(pop == "EUR") %>% drop_na(PC1)
table(data_EUR[,c("a1")])
tbl <- table(data_EUR[,c("snp","a1")])
tmp1 <- binconf(tbl[1,2],sum(tbl[,2]))
tmp2 <- binconf(tbl[2,2],sum(tbl[,2]))
tmp3 <- binconf(tbl[1,1],sum(tbl[,1]))
tmp4 <- binconf(tbl[2,1],sum(tbl[,1]))
tbl[1,2] <- paste0(round(tmp1[1]*100,1),"% [",round(tmp1[2]*100,1),"; ",round(tmp1[3]*100,1),"] (",tbl[1,2],")")
tbl[2,2] <- paste0(round(tmp2[1]*100,1),"% [",round(tmp2[2]*100,1),"; ",round(tmp2[3]*100,1),"] (",tbl[2,2],")")
tbl[1,1] <- paste0(round(tmp3[1]*100,1),"% [",round(tmp3[2]*100,1),"; ",round(tmp3[3]*100,1),"] (",tbl[1,1],")")
tbl[2,1] <- paste0(round(tmp4[1]*100,1),"% [",round(tmp4[2]*100,1),"; ",round(tmp4[3]*100,1),"] (",tbl[2,1],")")
tbl
